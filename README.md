# Yandex

Это репозиторий для проекта, который являются частью отборочных испытаний.

Ссылка на [ТЗ](https://disk.yandex.ru/d/TbWKTZbnOST80Q?w=1)

## Инициализация

Клонируйте репозиторий к себе на машину.  

Для скачивания необходимых библиотек будет нужен pip.
Если его нет, то установить его можно командами:

```shell
sudo apt-get update
sudo apt install python3-pip
```

Данный проект нуждается в библиотеках, которых нет по умолчанию. 
Нужные зависимости указаны в файле `requirements.txt`.
Для установки нужных библиотек воспользуетесь командой:

```shell
pip3 install -r requirements.txt
```

## Тестирование 

Для запуска тестов в файле `__init__.py` на 8 строчке нужно указать `_is_Test = True`.
Для запуска самого сервера нужно указать `_is_Test = False`
Это сделано (не самым лучшим образом) для того, чтобы запускать тесты, которые будут получать одинаковый результат. Так как в методах сервера используется текущее время, то в зависимости от времени запроса, мы будем получать разные ответы. Установив флаг `is_Test == True` мы устанавливаем текущее время равным "14:00". 

В директории находится файл с тестами `TestClient.py`. 
Для запуска теста можно запустить файл с помощью:
```python
python3 TestClient.py
```

Будет запущена функция test_pack(), которая вызовет функции тестирования в нужном порядке. 
Тесты устроены так, чтобы покрывать потенциально проблемные места.

## Запуск

Установим в файле `__init__.py` значение `_is_Test = False`, если это не сделано.

Для запуска сервиса на `0.0.0.0:8080` перейдем в директорию, которая на уровень выше директории, где находится проект. 
Например, если вы клонировали репозиторий в папку `project` (соответственно у вас будет `/project/Yandex`), то вам нужно перейти в папку `/project` и ввести в терминале:

```shell
gunicorn -w 4 -b 0.0.0.0:8080 --chdir /<путь_до_папки_Yandex>/Yandex/ Yandex:application
```

Для завершения работы нужно нажать сочетания `ctrl + C`. 

На случай, если при запуске будет ошибка подключения (при выполнении команды выше, будет ошибка подключения), то можно попробовать команды:


1) Вывести все pid, которые создал gunicorn
    ```
    pgrep gunicorn
    ```

2) Удалить все процессы, которые блокируют порт 8080:
    ```
    sudo fuser -k 8080/tcp
    ```
